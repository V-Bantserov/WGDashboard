import{_ as y,c as a,a as s,l as g,b as u,j as A,t as c,F as v,k as _,d as b,e as l,q as r,A as m,L as h,B as p,g as P,D as C,f as d,n as M}from"./index-BtR8u1Yc.js";import{L as k}from"./localeText-CcPMTEBg.js";/* empty css                                                                            */const x={name:"dashboardAdminUsers",components:{LocaleText:k},setup(){return{store:C()}},data(){return{admins:[],loading:!0,showAddModal:!1,showEditModal:!1,showResetPasswordModal:!1,showChangePasswordModal:!1,newAdmin:{username:"",password:"",confirmPassword:"",email:""},editAdmin:{id:null,username:"",email:""},resetPassword:{id:null,username:"",newPassword:"",confirmPassword:""},changePassword:{currentPassword:"",newPassword:"",confirmPassword:""},currentAdmin:null,saving:!1}},mounted(){this.loadAdmins(),this.loadCurrentAdmin()},methods:{async loadAdmins(){this.loading=!0,await P("/api/admins",{},t=>{t.status?this.admins=t.data:this.store.newMessage("Server",t.message,"danger"),this.loading=!1})},async loadCurrentAdmin(){await P("/api/admins/current",{},t=>{t.status&&(this.currentAdmin=t.data)})},openAddModal(){this.newAdmin={username:"",password:"",confirmPassword:"",email:""},this.showAddModal=!0},async addAdmin(){if(!this.newAdmin.username||!this.newAdmin.password){this.store.newMessage("Error","Username and password are required","danger");return}if(this.newAdmin.password!==this.newAdmin.confirmPassword){this.store.newMessage("Error","Passwords do not match","danger");return}this.saving=!0,await p("/api/admins/add",{username:this.newAdmin.username,password:this.newAdmin.password,email:this.newAdmin.email},t=>{t.status?(this.store.newMessage("Server","Admin created successfully","success"),this.showAddModal=!1,this.loadAdmins()):this.store.newMessage("Server",t.message,"danger"),this.saving=!1})},openEditModal(t){this.editAdmin={id:t.id,username:t.username,email:t.email||""},this.showEditModal=!0},async updateAdmin(){if(!this.editAdmin.username){this.store.newMessage("Error","Username is required","danger");return}this.saving=!0,await p("/api/admins/update",{id:this.editAdmin.id,username:this.editAdmin.username,email:this.editAdmin.email},t=>{t.status?(this.store.newMessage("Server","Admin updated successfully","success"),this.showEditModal=!1,this.loadAdmins()):this.store.newMessage("Server",t.message,"danger"),this.saving=!1})},openResetPasswordModal(t){this.resetPassword={id:t.id,username:t.username,newPassword:"",confirmPassword:""},this.showResetPasswordModal=!0},async resetAdminPassword(){if(!this.resetPassword.newPassword){this.store.newMessage("Error","New password is required","danger");return}if(this.resetPassword.newPassword!==this.resetPassword.confirmPassword){this.store.newMessage("Error","Passwords do not match","danger");return}this.saving=!0,await p("/api/admins/resetPassword",{id:this.resetPassword.id,newPassword:this.resetPassword.newPassword},t=>{t.status?(this.store.newMessage("Server","Password reset successfully","success"),this.showResetPasswordModal=!1):this.store.newMessage("Server",t.message,"danger"),this.saving=!1})},openChangePasswordModal(){this.changePassword={currentPassword:"",newPassword:"",confirmPassword:""},this.showChangePasswordModal=!0},async changeOwnPassword(){if(!this.changePassword.currentPassword||!this.changePassword.newPassword){this.store.newMessage("Error","All fields are required","danger");return}if(this.changePassword.newPassword!==this.changePassword.confirmPassword){this.store.newMessage("Error","New passwords do not match","danger");return}this.saving=!0,await p("/api/admins/changePassword",{currentPassword:this.changePassword.currentPassword,newPassword:this.changePassword.newPassword},t=>{t.status?(this.store.newMessage("Server","Password changed successfully","success"),this.showChangePasswordModal=!1):this.store.newMessage("Server",t.message,"danger"),this.saving=!1})},async deleteAdmin(t){confirm(`Are you sure you want to delete admin "${t.username}"?`)&&await p("/api/admins/delete",{id:t.id},e=>{e.status?(this.store.newMessage("Server",e.message,"success"),this.loadAdmins()):this.store.newMessage("Server",e.message,"danger")})},isCurrentAdmin(t){return this.currentAdmin&&this.currentAdmin.id===t.id},formatDate(t){return t?new Date(t).toLocaleString():"Never"}}},E={class:"card rounded-3"},U={class:"card-header d-flex align-items-center"},V={class:"my-2"},S={class:"badge bg-primary ms-2"},N={class:"card-body d-flex flex-column gap-2"},R={class:"d-flex gap-2 mb-2"},D={key:0,class:"text-center py-4"},L={key:1,class:"table-responsive"},T={class:"table table-hover mb-0"},q={class:"text-end"},B={key:0,class:"badge bg-success ms-1"},O={key:0,class:"badge bg-success"},F={key:1,class:"badge bg-secondary"},Y={class:"text-end"},j={class:"btn-group btn-group-sm"},z=["onClick"],G=["onClick"],I=["onClick","disabled"],H={key:0,class:"modal show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},J={class:"modal-dialog modal-dialog-centered"},K={class:"modal-content"},Q={class:"modal-header"},W={class:"modal-body"},X={class:"mb-3"},Z=["disabled"],$={class:"mb-3"},ss=["disabled"],es={class:"mb-3"},os=["disabled"],ns={class:"mb-3"},ts=["disabled"],ds={class:"modal-footer"},ls=["disabled"],as=["disabled"],is={key:0,class:"spinner-border spinner-border-sm me-1"},rs={key:0,class:"modal show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},ms={class:"modal-dialog modal-dialog-centered"},ws={class:"modal-content"},us={class:"modal-header"},bs={class:"modal-body"},cs={class:"mb-3"},ps=["disabled"],gs={class:"mb-3"},hs=["disabled"],fs={class:"modal-footer"},vs=["disabled"],Ps=["disabled"],ys={key:0,class:"spinner-border spinner-border-sm me-1"},As={key:0,class:"modal show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},_s={class:"modal-dialog modal-dialog-centered"},Cs={class:"modal-content"},Ms={class:"modal-header"},ks={class:"modal-title"},xs={class:"modal-body"},Es={class:"mb-3"},Us=["disabled"],Vs={class:"mb-3"},Ss=["disabled"],Ns={class:"modal-footer"},Rs=["disabled"],Ds=["disabled"],Ls={key:0,class:"spinner-border spinner-border-sm me-1"},Ts={key:0,class:"modal show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"}},qs={class:"modal-dialog modal-dialog-centered"},Bs={class:"modal-content"},Os={class:"modal-header"},Fs={class:"modal-body"},Ys={class:"mb-3"},js=["disabled"],zs={class:"mb-3"},Gs=["disabled"],Is={class:"mb-3"},Hs=["disabled"],Js={class:"modal-footer"},Ks=["disabled"],Qs=["disabled"],Ws={key:0,class:"spinner-border spinner-border-sm me-1"};function Xs(t,e,Zs,$s,o,i){const w=A("LocaleText");return d(),a(v,null,[s("div",E,[s("div",U,[s("h6",V,[e[25]||(e[25]=s("i",{class:"bi bi-people-fill me-2"},null,-1)),u(w,{t:"Admin Users"})]),s("span",S,c(o.admins.length),1)]),s("div",N,[s("div",R,[s("button",{class:"btn bg-primary-subtle text-primary-emphasis border-1 border-primary-subtle rounded-3 shadow-sm",onClick:e[0]||(e[0]=n=>i.openAddModal())},[e[26]||(e[26]=s("i",{class:"bi bi-person-plus-fill me-2"},null,-1)),u(w,{t:"Add Admin"})]),s("button",{class:"btn bg-secondary-subtle text-secondary-emphasis border-1 border-secondary-subtle rounded-3 shadow-sm",onClick:e[1]||(e[1]=n=>i.openChangePasswordModal())},[e[27]||(e[27]=s("i",{class:"bi bi-key-fill me-2"},null,-1)),u(w,{t:"Change My Password"})])]),o.loading?(d(),a("div",D,[...e[28]||(e[28]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)])])):(d(),a("div",L,[s("table",T,[s("thead",null,[s("tr",null,[s("th",null,[u(w,{t:"Username"})]),s("th",null,[u(w,{t:"Email"})]),s("th",null,[u(w,{t:"Created"})]),s("th",null,[u(w,{t:"Last Login"})]),s("th",null,[u(w,{t:"TOTP"})]),s("th",q,[u(w,{t:"Actions"})])])]),s("tbody",null,[(d(!0),a(v,null,_(o.admins,n=>(d(),a("tr",{key:n.id,class:M({"table-active":i.isCurrentAdmin(n)})},[s("td",null,[e[29]||(e[29]=s("i",{class:"bi bi-person-fill me-1"},null,-1)),l(" "+c(n.username)+" ",1),i.isCurrentAdmin(n)?(d(),a("span",B,"You")):b("",!0)]),s("td",null,c(n.email||"-"),1),s("td",null,[s("small",null,c(i.formatDate(n.created_at)),1)]),s("td",null,[s("small",null,c(i.formatDate(n.last_login)),1)]),s("td",null,[n.enable_totp?(d(),a("span",O,[...e[30]||(e[30]=[s("i",{class:"bi bi-shield-check"},null,-1),l(" Enabled ",-1)])])):(d(),a("span",F,"Disabled"))]),s("td",Y,[s("div",j,[s("button",{class:"btn btn-outline-primary",onClick:f=>i.openEditModal(n),title:"Edit"},[...e[31]||(e[31]=[s("i",{class:"bi bi-pencil"},null,-1)])],8,z),s("button",{class:"btn btn-outline-warning",onClick:f=>i.openResetPasswordModal(n),title:"Reset Password"},[...e[32]||(e[32]=[s("i",{class:"bi bi-key"},null,-1)])],8,G),s("button",{class:"btn btn-outline-danger",onClick:f=>i.deleteAdmin(n),disabled:i.isCurrentAdmin(n)||o.admins.length<=1,title:"Delete"},[...e[33]||(e[33]=[s("i",{class:"bi bi-trash"},null,-1)])],8,I)])])],2))),128))])])]))])]),(d(),g(h,{to:"body"},[o.showAddModal?(d(),a("div",H,[s("div",J,[s("div",K,[s("div",Q,[e[34]||(e[34]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-person-plus-fill me-2"}),l("Add New Admin ")],-1)),s("button",{type:"button",class:"btn-close",onClick:e[2]||(e[2]=n=>o.showAddModal=!1)})]),s("div",W,[s("div",X,[e[35]||(e[35]=s("label",{class:"form-label"},[l("Username "),s("span",{class:"text-danger"},"*")],-1)),r(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=n=>o.newAdmin.username=n),placeholder:"Enter username",disabled:o.saving},null,8,Z),[[m,o.newAdmin.username]])]),s("div",$,[e[36]||(e[36]=s("label",{class:"form-label"},"Email",-1)),r(s("input",{type:"email",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=n=>o.newAdmin.email=n),placeholder:"Enter email (optional)",disabled:o.saving},null,8,ss),[[m,o.newAdmin.email]])]),s("div",es,[e[37]||(e[37]=s("label",{class:"form-label"},[l("Password "),s("span",{class:"text-danger"},"*")],-1)),r(s("input",{type:"password",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=n=>o.newAdmin.password=n),placeholder:"Enter password",disabled:o.saving},null,8,os),[[m,o.newAdmin.password]])]),s("div",ns,[e[38]||(e[38]=s("label",{class:"form-label"},[l("Confirm Password "),s("span",{class:"text-danger"},"*")],-1)),r(s("input",{type:"password",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=n=>o.newAdmin.confirmPassword=n),placeholder:"Confirm password",disabled:o.saving},null,8,ts),[[m,o.newAdmin.confirmPassword]])])]),s("div",ds,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[7]||(e[7]=n=>o.showAddModal=!1),disabled:o.saving}," Cancel ",8,ls),s("button",{type:"button",class:"btn btn-primary",onClick:e[8]||(e[8]=n=>i.addAdmin()),disabled:o.saving},[o.saving?(d(),a("span",is)):b("",!0),e[39]||(e[39]=l(" Add Admin ",-1))],8,as)])])])])):b("",!0)])),(d(),g(h,{to:"body"},[o.showEditModal?(d(),a("div",rs,[s("div",ms,[s("div",ws,[s("div",us,[e[40]||(e[40]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-pencil me-2"}),l("Edit Admin ")],-1)),s("button",{type:"button",class:"btn-close",onClick:e[9]||(e[9]=n=>o.showEditModal=!1)})]),s("div",bs,[s("div",cs,[e[41]||(e[41]=s("label",{class:"form-label"},[l("Username "),s("span",{class:"text-danger"},"*")],-1)),r(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[10]||(e[10]=n=>o.editAdmin.username=n),placeholder:"Enter username",disabled:o.saving},null,8,ps),[[m,o.editAdmin.username]])]),s("div",gs,[e[42]||(e[42]=s("label",{class:"form-label"},"Email",-1)),r(s("input",{type:"email",class:"form-control","onUpdate:modelValue":e[11]||(e[11]=n=>o.editAdmin.email=n),placeholder:"Enter email (optional)",disabled:o.saving},null,8,hs),[[m,o.editAdmin.email]])])]),s("div",fs,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[12]||(e[12]=n=>o.showEditModal=!1),disabled:o.saving}," Cancel ",8,vs),s("button",{type:"button",class:"btn btn-primary",onClick:e[13]||(e[13]=n=>i.updateAdmin()),disabled:o.saving},[o.saving?(d(),a("span",ys)):b("",!0),e[43]||(e[43]=l(" Save Changes ",-1))],8,Ps)])])])])):b("",!0)])),(d(),g(h,{to:"body"},[o.showResetPasswordModal?(d(),a("div",As,[s("div",_s,[s("div",Cs,[s("div",Ms,[s("h5",ks,[e[44]||(e[44]=s("i",{class:"bi bi-key me-2"},null,-1)),l("Reset Password for "+c(o.resetPassword.username),1)]),s("button",{type:"button",class:"btn-close",onClick:e[14]||(e[14]=n=>o.showResetPasswordModal=!1)})]),s("div",xs,[s("div",Es,[e[45]||(e[45]=s("label",{class:"form-label"},[l("New Password "),s("span",{class:"text-danger"},"*")],-1)),r(s("input",{type:"password",class:"form-control","onUpdate:modelValue":e[15]||(e[15]=n=>o.resetPassword.newPassword=n),placeholder:"Enter new password",disabled:o.saving},null,8,Us),[[m,o.resetPassword.newPassword]])]),s("div",Vs,[e[46]||(e[46]=s("label",{class:"form-label"},[l("Confirm Password "),s("span",{class:"text-danger"},"*")],-1)),r(s("input",{type:"password",class:"form-control","onUpdate:modelValue":e[16]||(e[16]=n=>o.resetPassword.confirmPassword=n),placeholder:"Confirm new password",disabled:o.saving},null,8,Ss),[[m,o.resetPassword.confirmPassword]])])]),s("div",Ns,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[17]||(e[17]=n=>o.showResetPasswordModal=!1),disabled:o.saving}," Cancel ",8,Rs),s("button",{type:"button",class:"btn btn-warning",onClick:e[18]||(e[18]=n=>i.resetAdminPassword()),disabled:o.saving},[o.saving?(d(),a("span",Ls)):b("",!0),e[47]||(e[47]=l(" Reset Password ",-1))],8,Ds)])])])])):b("",!0)])),(d(),g(h,{to:"body"},[o.showChangePasswordModal?(d(),a("div",Ts,[s("div",qs,[s("div",Bs,[s("div",Os,[e[48]||(e[48]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-key-fill me-2"}),l("Change Your Password ")],-1)),s("button",{type:"button",class:"btn-close",onClick:e[19]||(e[19]=n=>o.showChangePasswordModal=!1)})]),s("div",Fs,[s("div",Ys,[e[49]||(e[49]=s("label",{class:"form-label"},[l("Current Password "),s("span",{class:"text-danger"},"*")],-1)),r(s("input",{type:"password",class:"form-control","onUpdate:modelValue":e[20]||(e[20]=n=>o.changePassword.currentPassword=n),placeholder:"Enter current password",disabled:o.saving},null,8,js),[[m,o.changePassword.currentPassword]])]),s("div",zs,[e[50]||(e[50]=s("label",{class:"form-label"},[l("New Password "),s("span",{class:"text-danger"},"*")],-1)),r(s("input",{type:"password",class:"form-control","onUpdate:modelValue":e[21]||(e[21]=n=>o.changePassword.newPassword=n),placeholder:"Enter new password",disabled:o.saving},null,8,Gs),[[m,o.changePassword.newPassword]])]),s("div",Is,[e[51]||(e[51]=s("label",{class:"form-label"},[l("Confirm New Password "),s("span",{class:"text-danger"},"*")],-1)),r(s("input",{type:"password",class:"form-control","onUpdate:modelValue":e[22]||(e[22]=n=>o.changePassword.confirmPassword=n),placeholder:"Confirm new password",disabled:o.saving},null,8,Hs),[[m,o.changePassword.confirmPassword]])])]),s("div",Js,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[23]||(e[23]=n=>o.showChangePasswordModal=!1),disabled:o.saving}," Cancel ",8,Ks),s("button",{type:"button",class:"btn btn-primary",onClick:e[24]||(e[24]=n=>i.changeOwnPassword()),disabled:o.saving},[o.saving?(d(),a("span",Ws)):b("",!0),e[52]||(e[52]=l(" Change Password ",-1))],8,Qs)])])])])):b("",!0)]))],64)}const ne=y(x,[["render",Xs],["__scopeId","data-v-e88be9a2"]]);export{ne as default};
