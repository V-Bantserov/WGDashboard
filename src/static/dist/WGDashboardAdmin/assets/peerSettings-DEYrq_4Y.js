import{_ as v,j as y,c as d,f as r,a as e,d as m,b as i,t as u,q as l,A as n,n as x,a2 as k,e as w,F as b,k as _,B as p,g as f,D as S}from"./index-BtR8u1Yc.js";import{L as C}from"./localeText-CcPMTEBg.js";const P={name:"peerSettings",components:{LocaleText:C},props:{selectedPeer:Object},data(){return{data:void 0,dataChanged:!1,showKey:!1,saving:!1,notifyEmails:"",notifyWebhooks:[],notifyEvents:["peer_went_online","peer_went_offline","peer_endpoint_changed"],availableWebhooks:[],availableEvents:[{id:"peer_went_online",label:"Went Online"},{id:"peer_went_offline",label:"Went Offline"},{id:"peer_endpoint_changed",label:"Endpoint Changed"}]}},setup(){return{dashboardConfigurationStore:S()}},methods:{reset(){this.selectedPeer&&(this.data=JSON.parse(JSON.stringify(this.selectedPeer)),(this.data.notes===void 0||this.data.notes===null)&&(this.data.notes=""),this.dataChanged=!1)},savePeer(){this.saving=!0,p(`/api/updatePeerSettings/${this.$route.params.id}`,this.data,a=>{this.saving=!1,a.status?this.dashboardConfigurationStore.newMessage("Server","Peer saved","success"):this.dashboardConfigurationStore.newMessage("Server",a.message,"danger"),this.$emit("refresh")})},resetPeerData(a){this.saving=!0,p(`/api/resetPeerData/${this.$route.params.id}`,{id:this.data.id,type:a},t=>{this.saving=!1,t.status?this.dashboardConfigurationStore.newMessage("Server","Peer data usage reset successfully","success"):this.dashboardConfigurationStore.newMessage("Server",t.message,"danger"),this.$emit("refresh")})},loadNotifyConfig(){this.selectedPeer?.id&&(f(`/api/health/peer/${encodeURIComponent(this.selectedPeer.id)}/notify`,{},a=>{a.status&&(this.notifyEmails=(a.data.emails||[]).join(", "),this.notifyWebhooks=[...a.data.webhooks||[]],this.notifyEvents=[...a.data.events||["peer_went_online","peer_went_offline","peer_endpoint_changed"]])}),f("/api/webHooks/getWebHooks",{},a=>{this.availableWebhooks=a.data||[]}))},saveNotifyConfig(){const a=this.notifyEmails.split(",").map(t=>t.trim()).filter(t=>t.length>0);p(`/api/health/peer/${encodeURIComponent(this.selectedPeer.id)}/notify`,{emails:a,webhooks:this.notifyWebhooks,events:this.notifyEvents},t=>{t.status&&this.dashboardConfigurationStore.newMessage("Server","Notification settings saved","success")})},toggleNotifyEvent(a){const t=this.notifyEvents.indexOf(a);t>=0?this.notifyEvents.splice(t,1):this.notifyEvents.push(a)},toggleNotifyWebhook(a){const t=this.notifyWebhooks.indexOf(a);t>=0?this.notifyWebhooks.splice(t,1):this.notifyWebhooks.push(a)}},beforeMount(){this.reset(),this.loadNotifyConfig()},mounted(){this.$el.querySelectorAll("input, textarea").forEach(a=>{a.addEventListener("change",()=>{this.dataChanged=!0})})}},N={class:"peerSettingContainer w-100 h-100 position-absolute top-0 start-0 overflow-y-scroll"},E={class:"container d-flex h-100 w-100"},D={class:"m-auto modal-dialog-centered dashboardModal"},W={class:"card rounded-3 shadow flex-grow-1"},U={class:"card-header bg-transparent d-flex align-items-center gap-2 border-0 p-4 pb-2"},V={class:"mb-0"},$={key:0,class:"card-body px-4"},A={class:"d-flex flex-column gap-2 mb-4"},I={class:"d-flex align-items-center"},K={class:"text-muted"},M={class:"ms-auto"},O={for:"peer_name_textbox",class:"form-label"},R={class:"text-muted"},H=["disabled"],L={for:"peer_notes_textbox",class:"form-label"},T={class:"text-muted"},B=["disabled"],q={class:"d-flex position-relative"},j={for:"peer_private_key_textbox",class:"form-label"},F={class:"text-muted"},J=["type","disabled"],z={for:"peer_allowed_ip_textbox",class:"form-label"},G={class:"text-muted"},Q=["disabled"],X={for:"peer_endpoint_allowed_ips",class:"form-label"},Y={class:"text-muted"},Z=["disabled"],ee={for:"peer_DNS_textbox",class:"form-label"},te={class:"text-muted"},se=["disabled"],oe={class:"accordion my-3",id:"peerSettingsAccordion"},ie={class:"accordion-item"},ae={class:"accordion-header"},le={class:"accordion-button rounded-3 collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#peerSettingsAccordionOptional"},ne={id:"peerSettingsAccordionOptional",class:"accordion-collapse collapse","data-bs-parent":"#peerSettingsAccordion"},de={class:"accordion-body d-flex flex-column gap-2 mb-2"},re={for:"peer_preshared_key_textbox",class:"form-label"},ce={class:"text-muted"},he=["disabled"],pe={for:"peer_mtu",class:"form-label"},me={class:"text-muted"},ue=["disabled"],be={for:"peer_keep_alive",class:"form-label"},_e={class:"text-muted"},fe=["disabled"],ge={class:"accordion my-3",id:"notifySettingsAccordion"},ve={class:"accordion-item"},ye={class:"accordion-header"},xe={class:"accordion-button rounded-3 collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#notifySettingsAccordionBody"},ke={id:"notifySettingsAccordionBody",class:"accordion-collapse collapse","data-bs-parent":"#notifySettingsAccordion"},we={class:"accordion-body d-flex flex-column gap-2 mb-2"},Se={class:"form-label"},Ce={class:"text-muted"},Pe={class:"d-flex align-items-center gap-2 mt-2"},Ne={class:"text-muted text-nowrap"},Ee={class:"d-flex flex-wrap gap-3"},De=["id","checked","onChange"],We=["for"],Ue={key:0},Ve={class:"form-label"},$e={class:"text-muted"},Ae=["id","checked","onChange"],Ie=["for"],Ke={class:"text-end"},Me={class:"d-flex align-items-center gap-2"},Oe=["disabled"],Re=["disabled"],He={class:"d-flex gap-2 align-items-center"},Le={class:"d-flex gap-2 ms-auto"};function Te(a,t,Be,qe,c,h){const o=y("LocaleText");return r(),d("div",N,[e("div",E,[e("div",D,[e("div",W,[e("div",U,[e("h4",V,[i(o,{t:"Peer Settings"})]),e("button",{type:"button",class:"btn-close ms-auto",onClick:t[0]||(t[0]=s=>this.$emit("close")),"aria-label":"Close"})]),this.data?(r(),d("div",$,[e("div",A,[e("div",I,[e("small",K,[i(o,{t:"Public Key"})]),e("small",M,[e("samp",null,u(this.data.id),1)])]),e("div",null,[e("label",O,[e("small",R,[i(o,{t:"Name"})])]),l(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:this.saving,"onUpdate:modelValue":t[1]||(t[1]=s=>this.data.name=s),id:"peer_name_textbox",placeholder:""},null,8,H),[[n,this.data.name]])]),e("div",null,[e("label",L,[e("small",T,[i(o,{t:"Notes"})])]),l(e("textarea",{class:"form-control form-control-sm rounded-3",disabled:this.saving,"onUpdate:modelValue":t[2]||(t[2]=s=>this.data.notes=s),id:"peer_notes_textbox",rows:"3",placeholder:""},null,8,B),[[n,this.data.notes]])]),e("div",null,[e("div",q,[e("label",j,[e("small",F,[i(o,{t:"Private Key"}),e("code",null,[i(o,{t:"(Required for QR Code and Download)"})])])]),e("a",{role:"button",class:"ms-auto text-decoration-none toggleShowKey",onClick:t[3]||(t[3]=s=>this.showKey=!this.showKey)},[e("i",{class:x(["bi",[this.showKey?"bi-eye-slash-fill":"bi-eye-fill"]])},null,2)])]),l(e("input",{type:[this.showKey?"text":"password"],class:"form-control form-control-sm rounded-3",disabled:this.saving,"onUpdate:modelValue":t[4]||(t[4]=s=>this.data.private_key=s),id:"peer_private_key_textbox",style:{"padding-right":"40px"}},null,8,J),[[k,this.data.private_key]])]),e("div",null,[e("label",z,[e("small",G,[i(o,{t:"Allowed IPs"}),e("code",null,[i(o,{t:"(Required)"})])])]),l(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:this.saving,"onUpdate:modelValue":t[5]||(t[5]=s=>this.data.allowed_ip=s),id:"peer_allowed_ip_textbox"},null,8,Q),[[n,this.data.allowed_ip]])]),e("div",null,[e("label",X,[e("small",Y,[i(o,{t:"Endpoint Allowed IPs"}),e("code",null,[i(o,{t:"(Required)"})])])]),l(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:this.saving,"onUpdate:modelValue":t[6]||(t[6]=s=>this.data.endpoint_allowed_ip=s),id:"peer_endpoint_allowed_ips"},null,8,Z),[[n,this.data.endpoint_allowed_ip]])]),e("div",null,[e("label",ee,[e("small",te,[i(o,{t:"DNS"})])]),l(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:this.saving,"onUpdate:modelValue":t[7]||(t[7]=s=>this.data.DNS=s),id:"peer_DNS_textbox"},null,8,se),[[n,this.data.DNS]])]),e("div",oe,[e("div",ie,[e("h2",ae,[e("button",le,[i(o,{t:"Optional Settings"})])]),e("div",ne,[e("div",de,[e("div",null,[e("label",re,[e("small",ce,[i(o,{t:"Pre-Shared Key"})])]),l(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:this.saving,"onUpdate:modelValue":t[8]||(t[8]=s=>this.data.preshared_key=s),id:"peer_preshared_key_textbox"},null,8,he),[[n,this.data.preshared_key]])]),e("div",null,[e("label",pe,[e("small",me,[i(o,{t:"MTU"})])]),l(e("input",{type:"number",class:"form-control form-control-sm rounded-3",disabled:this.saving,"onUpdate:modelValue":t[9]||(t[9]=s=>this.data.mtu=s),id:"peer_mtu"},null,8,ue),[[n,this.data.mtu]])]),e("div",null,[e("label",be,[e("small",_e,[i(o,{t:"Persistent Keepalive"})])]),l(e("input",{type:"number",class:"form-control form-control-sm rounded-3",disabled:this.saving,"onUpdate:modelValue":t[10]||(t[10]=s=>this.data.keepalive=s),id:"peer_keep_alive"},null,8,fe),[[n,this.data.keepalive]])])])])])]),e("div",ge,[e("div",ve,[e("h2",ye,[e("button",xe,[t[18]||(t[18]=e("i",{class:"bi bi-bell me-2"},null,-1)),i(o,{t:"Notification Settings"})])]),e("div",ke,[e("div",we,[e("div",null,[e("label",Se,[e("small",Ce,[i(o,{t:"Email Addresses"})])]),l(e("input",{type:"text",class:"form-control form-control-sm rounded-3","onUpdate:modelValue":t[11]||(t[11]=s=>this.notifyEmails=s),placeholder:"admin@example.com, tech@example.com"},null,512),[[n,this.notifyEmails]])]),e("div",Pe,[e("small",Ne,[i(o,{t:"Events"}),t[19]||(t[19]=w(":",-1))]),e("div",Ee,[(r(!0),d(b,null,_(c.availableEvents,s=>(r(),d("div",{key:s.id,class:"form-check form-check-inline mb-0"},[e("input",{class:"form-check-input",type:"checkbox",id:"ps_evt_"+s.id,checked:c.notifyEvents.includes(s.id),onChange:g=>h.toggleNotifyEvent(s.id)},null,40,De),e("label",{class:"form-check-label",for:"ps_evt_"+s.id},[e("small",null,[i(o,{t:s.label},null,8,["t"])])],8,We)]))),128))])]),c.availableWebhooks.length>0?(r(),d("div",Ue,[e("label",Ve,[e("small",$e,[i(o,{t:"Webhooks"})])]),(r(!0),d(b,null,_(c.availableWebhooks,s=>(r(),d("div",{key:s.WebHookID,class:"form-check"},[e("input",{class:"form-check-input",type:"checkbox",id:"ps_wh_"+s.WebHookID,checked:c.notifyWebhooks.includes(s.WebHookID),onChange:g=>h.toggleNotifyWebhook(s.WebHookID)},null,40,Ae),e("label",{class:"form-check-label",for:"ps_wh_"+s.WebHookID},[e("small",null,u(s.PayloadURL),1)],8,Ie)]))),128))])):m("",!0),e("div",Ke,[e("button",{class:"btn btn-sm btn-primary rounded-3",onClick:t[12]||(t[12]=(...s)=>h.saveNotifyConfig&&h.saveNotifyConfig(...s))},[t[20]||(t[20]=e("i",{class:"bi bi-check-lg me-1"},null,-1)),i(o,{t:"Save"})])])])])])]),e("div",Me,[e("button",{class:"btn bg-secondary-subtle border-secondary-subtle text-secondary-emphasis rounded-3 shadow ms-auto px-3 py-2",onClick:t[13]||(t[13]=s=>this.reset()),disabled:!this.dataChanged||this.saving},[t[21]||(t[21]=e("i",{class:"bi bi-arrow-clockwise me-2"},null,-1)),i(o,{t:"Reset"})],8,Oe),e("button",{class:"btn bg-primary-subtle border-primary-subtle text-primary-emphasis rounded-3 px-3 py-2 shadow",disabled:!this.dataChanged||this.saving,onClick:t[14]||(t[14]=s=>this.savePeer())},[t[22]||(t[22]=e("i",{class:"bi bi-save-fill me-2"},null,-1)),i(o,{t:"Save"})],8,Re)]),t[26]||(t[26]=e("hr",null,null,-1)),e("div",He,[e("strong",null,[i(o,{t:"Reset Data Usage"})]),e("div",Le,[e("button",{class:"btn bg-primary-subtle text-primary-emphasis rounded-3 flex-grow-1 shadow-sm",onClick:t[15]||(t[15]=s=>this.resetPeerData("total"))},[t[23]||(t[23]=e("i",{class:"bi bi-arrow-down-up me-2"},null,-1)),i(o,{t:"Total"})]),e("button",{class:"btn bg-primary-subtle text-primary-emphasis rounded-3 flex-grow-1 shadow-sm",onClick:t[16]||(t[16]=s=>this.resetPeerData("receive"))},[t[24]||(t[24]=e("i",{class:"bi bi-arrow-down me-2"},null,-1)),i(o,{t:"Received"})]),e("button",{class:"btn bg-primary-subtle text-primary-emphasis rounded-3 flex-grow-1 shadow-sm",onClick:t[17]||(t[17]=s=>this.resetPeerData("sent"))},[t[25]||(t[25]=e("i",{class:"bi bi-arrow-up me-2"},null,-1)),i(o,{t:"Sent"})])])])])])):m("",!0)])])])])}const Je=v(P,[["render",Te],["__scopeId","data-v-bfae2a16"]]);export{Je as default};
